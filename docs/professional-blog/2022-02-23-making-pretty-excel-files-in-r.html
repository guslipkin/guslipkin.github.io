<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gus Lipkin">
<meta name="dcterms.date" content="2022-02-23">
<meta name="description" content="Using the openxlsx package in R and RStudio to make formatted Excel files">

<title>Gus Lipkin’s Awesome Website - Making Pretty Excel Files in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Gus Lipkin’s Awesome Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resume.html" rel="" target="">
 <span class="menu-text">My Résumé</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-my-blogs" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">My Blogs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-my-blogs">    
        <li>
    <a class="dropdown-item" href="../professional-blog.html" rel="" target="">
 <span class="dropdown-text">My Professional Blog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../personal-blog.html" rel="" target="">
 <span class="dropdown-text">My Personal Blog</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../contact.html" rel="" target="">
 <span class="menu-text">Contact Me</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://www.linkedin.com/in/guslipkin/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://www.github.com/guslipkin" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://guslipkin.medium.com/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-medium"></i></a>
    <a href="https://fosstodon.org/@guslipkin" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-mastodon"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#reading-an-existing-workbook" id="toc-reading-an-existing-workbook" class="nav-link" data-scroll-target="#reading-an-existing-workbook">Reading an Existing Workbook</a></li>
  <li><a href="#creating-a-workbook" id="toc-creating-a-workbook" class="nav-link" data-scroll-target="#creating-a-workbook">Creating a Workbook</a></li>
  <li><a href="#adding-styles" id="toc-adding-styles" class="nav-link" data-scroll-target="#adding-styles">Adding Styles</a></li>
  <li><a href="#conditional-formatting" id="toc-conditional-formatting" class="nav-link" data-scroll-target="#conditional-formatting">Conditional Formatting</a></li>
  <li><a href="#writing-the-workbook" id="toc-writing-the-workbook" class="nav-link" data-scroll-target="#writing-the-workbook">Writing the Workbook</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Making Pretty Excel Files in R</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">R: openxlsx</div>
    <div class="quarto-category">Excel</div>
  </div>
  </div>

<div>
  <div class="description">
    Using the openxlsx package in R and RStudio to make formatted Excel files
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gus Lipkin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 23, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><a href="https://guslipkin.medium.com/making-pretty-excel-files-in-r-46a15c7a2ee8"><em>Link to the Medium post</em></a></p>
<section id="intro" class="level1">
<h1>Intro</h1>
<p>It’s a tale as old as time. Your boss gave you a bunch of Excel files and you painstakingly made a bot that will import and display them in a Shiny dashboard. Proud of your work, you take it to your boss and they say “I don’t know what a ‘Shiny’ is, can’t you just give me one of those Excels back?” <code>openxlsx</code> makes this easy.</p>
<p>Today we’re going to recreate an existing workbook with <code>openxlsx.</code> To get started, I made a small <code>.xlsx</code> file for us to work with that can be downloaded <a href="../assets/post-assets/2022-02-23-making-pretty-excel-files-in-r/bbq.xlsx">here</a>. It’s an attendance list and some notes on supplies you’ll need for a company barbecue. Feel free to get familiar with it then come back here when you’re ready.</p>
<div id="fig-grouped-stacked" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-attendancePreview" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-02-23-making-pretty-excel-files-in-r/attendancePreview.png" class="img-fluid figure-img" data-ref-parent="fig-grouped-stacked"></p>
<figcaption class="figure-caption">(a) The <code>attendance</code> sheet</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-suppliesPreview" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-02-23-making-pretty-excel-files-in-r/suppliesPreview.png" class="img-fluid figure-img" data-ref-parent="fig-grouped-stacked"></p>
<figcaption class="figure-caption">(b) The <code>supplies</code> sheet</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: A preview of the Attendance and Supplies sheets</figcaption><p></p>
</figure>
</div>
<hr>
</section>
<section id="reading-an-existing-workbook" class="level1">
<h1>Reading an Existing Workbook</h1>
<p>As usual, the first thing to do is load our library with <code>library(openxlsx)</code>. We can try and load the workbook, the Excel file, with <code>read.xlsx</code>, but for now we’re going to use <code>loadWorkbook</code>. This loads a workbook object and exposes some workbook properties to us rather than just the raw data like with <code>read.xlsx</code>.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-2_a48aa732011426017966806540d3581c">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load openxlsx</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get the sheet names</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>bbq <span class="ot">&lt;-</span> <span class="fu">loadWorkbook</span>(filePath)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bbq)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># load the sheets and preview them</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>attendance <span class="ot">&lt;-</span> <span class="fu">readWorkbook</span>(bbq, <span class="st">"Attendance"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(attendance)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>supplies <span class="ot">&lt;-</span> <span class="fu">readWorkbook</span>(bbq, <span class="at">sheet =</span> <span class="st">"Supplies"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(supplies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>[1] “Attendance” “Supplies”</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Name</th>
<th style="text-align: center;">RSVPed</th>
<th>Status</th>
<th>FoodPreference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Masud Durga</td>
<td style="text-align: center;">TRUE</td>
<td>No</td>
<td>NA</td>
</tr>
<tr class="even">
<td>2</td>
<td>Stanislav Zillah</td>
<td style="text-align: center;">TRUE</td>
<td>Yes</td>
<td>Hotdog</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Joaquina Aristide</td>
<td style="text-align: center;">FALSE</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="even">
<td>4</td>
<td>Iuppiter Dieu</td>
<td style="text-align: center;">TRUE</td>
<td>Yes</td>
<td>Hotdog</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Hari Evgenios</td>
<td style="text-align: center;">TRUE</td>
<td>Yes</td>
<td>Hamburger</td>
</tr>
<tr class="even">
<td>6</td>
<td>Shaina Gwenaelle</td>
<td style="text-align: center;">TRUE</td>
<td>Yes</td>
<td>Hotdog</td>
</tr>
</tbody>
</table>
<center>
<em style="color: grey;">The attendance data.frame</em>
</center>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>SupplyType</th>
<th style="text-align: center;">Quantity</th>
<th style="text-align: center;">PerPackage</th>
<th style="text-align: center;">PackagesNeeded</th>
<th style="text-align: center;">Leftover</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Hotdogs</td>
<td style="text-align: center;">34</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td>2</td>
<td>Hotdog buns</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Hamburgers</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>4</td>
<td>Hamburger buns</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table>
<center>
<em style="color: grey;">The supplies data.frame</em>
</center>
<p>Because we loaded the data as a workbook object, we can use <code>getStyles</code> to load the styles and preview them. Unfortunately, the styles can’t pull conditional formatting and don’t keep track of which cells use which styles. By cross referencing the list of styles and <code>bbq.xlsx</code>, we can identify some styles to use and them assign them each to a variable.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-3_1a3663095f689c255445a8ea6c3ea2fa">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getStyles and set them appropriately</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>styles <span class="ot">&lt;-</span> <span class="fu">getStyles</span>(bbq)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>styles</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't work for colors because those are conditional formatting</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>headerStyle <span class="ot">&lt;-</span> styles[[<span class="dv">1</span>]]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>numberStyle <span class="ot">&lt;-</span> styles[[<span class="dv">7</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>I’ve chosen to only show the first two items from the <code>styles</code> list here.</em></p>
<pre><code>[[1]]
A custom cell style. 

 Cell formatting: GENERAL 
 Font name: Calibri 
 Font size: 14 
 Font colour: 1 
 Font decoration: BOLD 
 

[[2]]
A custom cell style. 

 Cell formatting: GENERAL 
 Cell horz. align: center</code></pre>
<hr>
</section>
<section id="creating-a-workbook" class="level1">
<h1>Creating a Workbook</h1>
<p>First thing we have to do is create a workbook object that we’ll call <code>wb</code>. We can quickly preview it by just typing <code>wb</code> into our chunk or the console.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-4_a649e5575c1ee9e9b68be3b4e051bafe">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create workbook and check contents</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>wb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A Workbook object.
 
Worksheets:
 No worksheets attached</code></pre>
</div>
</div>
<p>We’re going to make the <code>Supplies</code> sheet first as it’s a little bit easier. We first add a new worksheet named <code>Supplies</code> to the workbook, then we can write the relevant data to that sheet along with styling our column headers using <code>headerStyle</code> from earlier.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-5_2ff1be158cc51cd04dac4ae07f2cc98b">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the supplies sheet and check for it</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(<span class="at">wb =</span> wb, <span class="at">sheetName =</span> <span class="st">"Supplies"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># write supplies to the worksheet using headerStyle</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Supplies"</span>, <span class="at">x =</span> supplies, <span class="at">headerStyle =</span> headerStyle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-styles" class="level1">
<h1>Adding Styles</h1>
<p>All of the numbers in the <code>Supplies</code> sheet are centered both horizontally and vertically. We can achieve this by adding the <code>numberStyle</code> from before to those cells. <code>rows</code> and <code>cols</code> both start at 2 because row one is the header row and column one is the supply type. <code>rows</code> goes to 5 because there are 4 rows of numbers (remember the header row) and <code>cols</code> goes to 5 because there are 4 columns of numbers. <code>gridExpand = TRUE</code> makes sure that all cell reference combinations possible with <code>rows</code> and <code>cols</code> are used, rather than doing an entire row or column.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-6_15babbb7ddd8ac924164ad54c3459585">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add numberStyle</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addStyle</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Supplies"</span>, <span class="at">style =</span> numberStyle, <span class="at">rows =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">gridExpand =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we go back to our data in R, the <code>Quantity</code> for Hotdog buns and Hamburger buns is empty. A bit further back, we see that that’s because those cells were merged with the <code>Quantity</code> of Hotdogs and Hamburgers respectively. We can replicate this using <code>mergeCells</code>. Unlike <code>addStyle</code>, we don’t need to use <code>gridExpand</code> to merge all the cells as it is implied. <code>cols</code> will be 2 for both and we want <code>rows</code> 2 and 3 for Hotdogs and <code>rows</code> 4 and 5 for Hamburgers.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-7_e0c380e93fdc0fec5d719a067342190b">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the hamburger and hotdog quantity cells</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mergeCells</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Supplies"</span>, <span class="at">cols =</span> <span class="dv">2</span>, <span class="at">rows =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mergeCells</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Supplies"</span>, <span class="at">cols =</span> <span class="dv">2</span>, <span class="at">rows =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our last step on this worksheet is to set the column widths to auto. We again need to specify <code>cols</code> and can just do <code>1:5</code> so that all columns are affected.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-8_2b722dbd3384f2ab976ccb1702cbd99e">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set column widths to auto</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setColWidths</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Supplies"</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">widths =</span> <span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou <code>Supplies</code> sheet is now complete, but we’re not going to write it just yet because we still need to do the <code>Attendance</code> sheet.</p>
<p>Like before, we first add the <code>Attendance</code> worksheet and write the data to it.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-9_1a63a583fdb40ee4a5232ea714707451">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the attendance sheet and check for it</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(<span class="at">wb =</span> wb, <span class="at">sheetName =</span> <span class="st">"Attendance"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># write attendance to the worksheet using the same headerStyle from before</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, <span class="at">x =</span> attendance, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">headerStyle =</span> headerStyle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="conditional-formatting" class="level1">
<h1>Conditional Formatting</h1>
<p>The <code>RSVPed</code> and <code>Status</code> columns each have some conditional formatting. We can reuse the color formatting from the <code>RSVPed</code> column on the <code>Status</code> column, so we’re going to separate the color style from the alignment style. It was easy to see how many rows we have in the <code>Supplies</code> sheet but not here so we’re going to create a new variable that has the <code>rowNumbers</code>. Again, we start on row 2 because of the header row and will end at our last data row plus 1.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-10_1096a7a98f7e2dc499acc00e7b3c0450">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create color styles for rsvp and status</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>goodStyle <span class="ot">&lt;-</span> <span class="fu">createStyle</span>(<span class="at">fontColour =</span> <span class="st">"#006100"</span>, <span class="at">bgFill =</span> <span class="st">"#C6EFCE"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>badStyle <span class="ot">&lt;-</span> <span class="fu">createStyle</span>(<span class="at">fontColour =</span> <span class="st">"#9C0006"</span>, <span class="at">bgFill =</span> <span class="st">"#FFC7CE"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create center style for rsvp column</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>centerStyle <span class="ot">&lt;-</span> <span class="fu">createStyle</span>(<span class="at">halign =</span> <span class="st">"center"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a variable of row numbers</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>rowNumbers <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(attendance) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our first step is to center the values in the <code>RSVPed</code> column with an <code>addStyle</code>. Next, while we could manually color each cell using a <code>for</code> loop, it’s more efficient to use <code>conditionalFormatting</code>. This also has the added bonus of showing in Excel and responding to any changes. The rule argument may be a little strange, and that’s because it must match how the same formatting rule would be written in Excel. In this case, we use our top-leftmost cell as the reference cell in the rule, <code>B2</code>, then we check if it is <code>TRUE</code> or <code>FALSE</code>. When the rule is applied down the cells in column <code>B</code>, the row number will change to match the current row.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-11_65a0cb723cbe2678256ecad3c8844cf9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># center the column values</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addStyle</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">style =</span> centerStyle, <span class="at">cols =</span> <span class="dv">2</span>, <span class="at">rows =</span> rowNumbers)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># IF `RSVPed` is TRUE, set it to green. IF FALSE, set it to red</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">conditionalFormatting</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, <span class="at">cols =</span> <span class="dv">2</span>, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows =</span> rowNumbers, <span class="at">rule =</span> <span class="st">"B2==TRUE"</span>, <span class="at">style =</span> goodStyle)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">conditionalFormatting</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, <span class="at">cols =</span> <span class="dv">2</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows =</span> rowNumbers, <span class="at">rule =</span> <span class="st">"B2==FALSE"</span>, <span class="at">style =</span> badStyle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>Status</code> column is very similar to the <code>RSVPed</code> column, but we add a style for <code>Tentative</code> responses and then need a third <code>conditionalFormatting</code>. The newest part here is in the <code>rule</code> argument. We need to put quotes around <code>Yes</code> so that Excel knows that it is a string and need to use <code>\"</code> so that R knows that the quote is part of the string. Once our formatting has been applied, we set the column widths as we did before.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-12_4b8abfd441d3ad2c78f830b9b41c05d9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add style for status and tentative</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>maybeStyle <span class="ot">&lt;-</span> <span class="fu">createStyle</span>(<span class="at">fontColour =</span> <span class="st">"#9C6500"</span>, <span class="at">bgFill =</span> <span class="st">"#FFEB9C"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">conditionalFormatting</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, <span class="at">cols =</span> <span class="dv">3</span>, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows =</span> rowNumbers, <span class="at">rule =</span> <span class="st">"C2==</span><span class="sc">\"</span><span class="st">Yes</span><span class="sc">\"</span><span class="st">"</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">style =</span> goodStyle)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">conditionalFormatting</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, <span class="at">cols =</span> <span class="dv">3</span>, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows =</span> rowNumbers, <span class="at">rule =</span> <span class="st">"C2==</span><span class="sc">\"</span><span class="st">No</span><span class="sc">\"</span><span class="st">"</span>, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">style =</span> badStyle)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">conditionalFormatting</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, <span class="at">cols =</span> <span class="dv">3</span>, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows =</span> rowNumbers, <span class="at">rule =</span> <span class="st">"C2==</span><span class="sc">\"</span><span class="st">Tentative</span><span class="sc">\"</span><span class="st">"</span>, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">style =</span> maybeStyle)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># set column widths to auto</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setColWidths</span>(<span class="at">wb =</span> wb, <span class="at">sheet =</span> <span class="st">"Attendance"</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">widths =</span> <span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="writing-the-workbook" class="level1">
<h1>Writing the Workbook</h1>
<p>The last thing we need to do is reorder the worksheets so that <code>Attendance</code> is first because when we created the workbook in R, we created the <code>Supplies</code> worksheet first. Unfortunately, <code>worksheetOrder</code> only supports integer vectors. We can check our worksheet numbers by calling the object again through either the chunk or console. Then we set the worksheet order and save the workbook to an <code>.xlsx</code> file.</p>
<div class="cell" data-hash="2022-02-23-making-pretty-excel-files-in-r_cache/html/unnamed-chunk-13_d7eb5ab34ca4c1b10f2d69fd82f1d5f3">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the workbook sheet order</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>wb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A Workbook object.
 
Worksheets:
 Sheet 1: "Supplies"
 
    Custom column widths (column: width)
      1: auto, 2: auto, 3: auto, 4: auto, 5: auto 
 

 Sheet 2: "Attendance"
 
    Custom column widths (column: width)
      1: auto, 2: auto, 3: auto, 4: auto 
 

 
 Worksheet write order: 1, 2
 Active Sheet 1: "Supplies" 
    Position: 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change the order</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">worksheetOrder</span>(wb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># save the workbook</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWorkbook</span>(wb, outputPath, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we open the new file, we can see that they are nearly identical. The biggest difference between the two is that the original used formulas to calculate the values in <code>Supplies</code>.</p>
<p>If you did want to take it a step further and use those instead, the <code>writeFormula</code> function is your friend. In any case, I highly encourage everyone to at least skim through the <code>openxlsx</code> documentation <a href="https://cran.r-project.org/web/packages/openxlsx/openxlsx.pdf">here</a> because it has so much to offer to help streamline Excel file generation.</p>
<hr>
<p>All the code for this article is available <a href="https://gist.github.com/guslipkin/bc0b1ab7861c431a08b8672bec50d806?file=openxlsxUsage.rmd">here</a>. If you want to see more from me, check out <a href="https://github.com/guslipkin">my GitHub</a> or <a href="https://guslipkin.github.io">guslipkin.github.io</a>. If you want to hear from me, I’m also on Twitter <a href="https://twitter.com/GusLipkin"><span class="citation" data-cites="guslipkin">@guslipkin</span></a>.</p>
<center>
<em>Gus Lipkin is a Data Scientist, Business Analyst, and occasional bike mechanic</em>
</center>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>