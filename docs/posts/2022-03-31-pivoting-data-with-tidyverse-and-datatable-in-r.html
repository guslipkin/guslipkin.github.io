<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.179">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gus Lipkin">
<meta name="dcterms.date" content="2022-03-31">
<meta name="description" content="pivot_wider/dcast and pivot_longer/melt all make sense with a bit of explaining.">

<title>Gus Lipkin’s Awesome Website - Pivoting Data with tidyverse and data.table in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Gus Lipkin’s Awesome Website</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About Me</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resume.html">My Résumé</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html">My Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contact.html">Contact Me</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/guslipkin/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.github.com/guslipkin"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.twitter.com/GusLipkin"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a>
  <ul class="collapse">
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting Started</a></li>
  </ul></li>
  <li><a href="#what-are" id="toc-what-are" class="nav-link" data-scroll-target="#what-are">What are…</a>
  <ul class="collapse">
  <li><a href="#pivot_wider-and-dcast" id="toc-pivot_wider-and-dcast" class="nav-link" data-scroll-target="#pivot_wider-and-dcast"><code>pivot_wider</code> and <code>dcast</code></a></li>
  <li><a href="#pivot_longer-and-melt" id="toc-pivot_longer-and-melt" class="nav-link" data-scroll-target="#pivot_longer-and-melt"><code>pivot_longer</code> and <code>melt</code></a></li>
  </ul></li>
  <li><a href="#checking-for-duplicates" id="toc-checking-for-duplicates" class="nav-link" data-scroll-target="#checking-for-duplicates">Checking for Duplicates</a></li>
  <li><a href="#pivot-wider" id="toc-pivot-wider" class="nav-link" data-scroll-target="#pivot-wider">Pivot Wider</a>
  <ul class="collapse">
  <li><a href="#wider-with-one-value-column" id="toc-wider-with-one-value-column" class="nav-link" data-scroll-target="#wider-with-one-value-column">Wider with One Value Column</a></li>
  <li><a href="#wider-with-two-or-more-value-columns" id="toc-wider-with-two-or-more-value-columns" class="nav-link" data-scroll-target="#wider-with-two-or-more-value-columns">Wider with Two or More Value Columns</a></li>
  <li><a href="#pivot-wider-two-or-more-id-columns" id="toc-pivot-wider-two-or-more-id-columns" class="nav-link" data-scroll-target="#pivot-wider-two-or-more-id-columns">Pivot Wider Two or More ID Columns</a></li>
  </ul></li>
  <li><a href="#pivot-longer" id="toc-pivot-longer" class="nav-link" data-scroll-target="#pivot-longer">Pivot Longer</a></li>
  <li><a href="#pivot-wider-from-longer" id="toc-pivot-wider-from-longer" class="nav-link" data-scroll-target="#pivot-wider-from-longer">Pivot Wider (from Longer)</a>
  <ul class="collapse">
  <li><a href="#pivot-wider-with-two-or-more-name-columns" id="toc-pivot-wider-with-two-or-more-name-columns" class="nav-link" data-scroll-target="#pivot-wider-with-two-or-more-name-columns">Pivot Wider with Two or More Name Columns</a></li>
  <li><a href="#pivot-wider-with-mutiple-id-and-name-columns" id="toc-pivot-wider-with-mutiple-id-and-name-columns" class="nav-link" data-scroll-target="#pivot-wider-with-mutiple-id-and-name-columns">Pivot Wider with Mutiple ID and Name Columns</a></li>
  </ul></li>
  <li><a href="#wrapping-things-up" id="toc-wrapping-things-up" class="nav-link" data-scroll-target="#wrapping-things-up">Wrapping Things Up</a>
  <ul class="collapse">
  <li><a href="#a-quick-benchmark" id="toc-a-quick-benchmark" class="nav-link" data-scroll-target="#a-quick-benchmark">A quick benchmark</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pivoting Data with tidyverse and data.table in R</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">R: tidyverse</div>
    <div class="quarto-category">R: data.table</div>
  </div>
  </div>

<div>
  <div class="description">
    pivot_wider/dcast and pivot_longer/melt all make sense with a bit of explaining.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gus Lipkin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 31, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>


<style>
.table-wrapper {
  overflow-x: scroll;
}
</style>
<section id="intro" class="level1">
<h1>Intro</h1>
<p>Pivoting data can be a little scary sometimes, even if you know exactly what you want to do. But it doesn’t need to be. I’m hoping that by the end of this post, you’ll feel like the pivot pro you always knew you could be.</p>
<div id="fig-giraffe-manta" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-giraffe" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r/giraffe.jpg" class="img-fluid figure-img" data-ref-parent="fig-giraffe-manta"></p>
<p></p><figcaption class="figure-caption">(a) A giraffe (longer)</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-manta" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r/mantaray.jpg" class="img-fluid figure-img" data-ref-parent="fig-giraffe-manta"></p>
<p></p><figcaption class="figure-caption">(b) A manta ray (wider)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Longer and wider animals</figcaption><p></p>
</figure>
</div>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<p>As usual, the first thing we want to do is load our libraries. We’ll be using <code>pivot_wider</code> and <code>pivot_longer</code> from <code>tidyverse</code> as well as the pipe operator, <code>%&gt;%</code> from <code>magrittr</code> which is loaded through <code>tidyverse</code>. We’re also using <code>dcast</code> and <code>melt</code> from <code>data.table</code> as they are twins to <code>pivot_wider</code> and <code>pivot_longer</code>, respectively. While they are not identical, they perform the same functions are operate somewhat similarly.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/LoadLibraries_3b65d0c8ec288b46f2c080a60d9dc7bd">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we want to create our dummy data. I’ve been working with theme park data a lot recently, so I modeled the dummy data after that. The data description is as follows:</p>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>variable</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>rideName</td>
<td>character</td>
<td>The full name of the ride</td>
</tr>
<tr class="even">
<td>shortName</td>
<td>character</td>
<td>A shortened version of the name of the ride</td>
</tr>
<tr class="odd">
<td>time</td>
<td>ITime (from <code>data.table</code>)</td>
<td>The time the data was recorded (every 5 minutes from 8am to 5pm)</td>
</tr>
<tr class="even">
<td>attendance</td>
<td>double</td>
<td>The theme park attendance during the time recorded</td>
</tr>
<tr class="odd">
<td>estimatedWait</td>
<td>double</td>
<td>The estimated wait time in minutes</td>
</tr>
<tr class="even">
<td>actualWait</td>
<td>double</td>
<td>The actual wait time in minutes</td>
</tr>
</tbody>
</table>
</div>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/CreateDummyData_1b95013c6dca816747bf750d546e0be5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rideName <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"The Amulet from Below"</span>, <span class="st">"The Strong Key Mystery"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"The Punishment of Bane"</span>, <span class="st">"The Mage Beyond the Grave"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"The Fury from Beyond"</span>), <span class="dv">108</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>shortName <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"amulet"</span>, <span class="st">"key"</span>, <span class="st">"punishment"</span>, <span class="st">"mage"</span>, <span class="st">"fury"</span>), <span class="dv">108</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">as.ITime</span>(<span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">3600</span>, <span class="dv">17</span><span class="sc">*</span><span class="dv">3600-1</span>, <span class="at">by =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">5</span>), <span class="at">times =</span> <span class="dv">1</span>, <span class="at">each =</span> <span class="dv">5</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>attendance <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">108</span>, <span class="dv">5000</span>, <span class="dv">100</span>)), <span class="at">times =</span> <span class="dv">1</span>, <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>estimatedWait <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="fu">length</span>(rideName), <span class="dv">50</span>, <span class="dv">10</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>actualWait <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="fu">length</span>(rideName), estimatedWait, <span class="dv">5</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(rideName, shortName, time, attendance, estimatedWait, actualWait)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once created, the data looks like this:</p>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>rideName</th>
<th>shortName</th>
<th>time</th>
<th>attendance</th>
<th>estimatedWait</th>
<th>actualWait</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>The Amulet from Below</td>
<td>amulet</td>
<td>08:00:00</td>
<td>5090</td>
<td>53</td>
<td>54</td>
</tr>
<tr class="even">
<td>The Strong Key Mystery</td>
<td>key</td>
<td>08:00:00</td>
<td>5090</td>
<td>62</td>
<td>64</td>
</tr>
<tr class="odd">
<td>The Punishment of Bane</td>
<td>punishment</td>
<td>08:00:00</td>
<td>5090</td>
<td>56</td>
<td>55</td>
</tr>
<tr class="even">
<td>The Mage Beyond the Grave</td>
<td>mage</td>
<td>08:00:00</td>
<td>5090</td>
<td>40</td>
<td>33</td>
</tr>
<tr class="odd">
<td>The Fury from Beyond</td>
<td>fury</td>
<td>08:00:00</td>
<td>5090</td>
<td>30</td>
<td>19</td>
</tr>
<tr class="even">
<td>The Amulet from Below</td>
<td>amulet</td>
<td>08:05:00</td>
<td>4883</td>
<td>45</td>
<td>48</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="what-are" class="level1">
<h1>What are…</h1>
<p><em>While I will show both <code>pivot_wider</code>/<code>dcast</code> and <code>pivot_longer</code>/<code>melt</code> in this post, I will default to the <code>pivot_*</code> term as it generally makes more sense on the surface.</em></p>
<section id="pivot_wider-and-dcast" class="level2">
<h2 class="anchored" data-anchor-id="pivot_wider-and-dcast"><code>pivot_wider</code> and <code>dcast</code></h2>
<p><code>pivot_wider</code> and <code>dcast</code> take data and reshapes it so that there are more columns and fewer rows than the input data. It allows you to specify a column as a unique identifier and use the values in one or more columns as new column names. The last column is the values that you want placed in the proper intersection between the identifier column value and each new column value.</p>
<div id="fig-original-wider" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-original" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r/original.png" class="img-fluid figure-img" data-ref-parent="fig-original-wider"></p>
<p></p><figcaption class="figure-caption">(a) The original data</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-wider" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r/wider.png" class="img-fluid figure-img" data-ref-parent="fig-original-wider"></p>
<p></p><figcaption class="figure-caption">(b) The wider data</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Wider data expands columns and decreases length</figcaption><p></p>
</figure>
</div>
<p>In the example above, I’ve pivoted the <code>actualWait</code> using the <code>time</code> and <code>shortName</code> columns. We can see that the first five rows of values in <code>actualWait</code> have become the first row of values in the wider data. The last row with <em>The Amulet from Below</em> at 8:05 becomes the value for <code>amulet</code> in the second row of the wider data where the <code>time</code> is 8:05.</p>
<p>While <code>pivot_wider</code> and <code>dcast</code> perform the same function, they behave a little bit differently. <code>pivot_wider</code> uses three main arguments <code>id_cols</code>, <code>names_from</code>, and <code>values_from</code>. <code>dcast</code>, on the other hand, uses a formula argument in place of both <code>id_cols</code> and <code>names_from</code> and <code>value.vars</code> in place of <code>values_from</code>. The second big difference is that column names in <code>pivot_wider</code> don’t have to be in quotes. They can be, but they don’t have to be. On the other hand, only the formula in <code>dcast</code> can go without quotes, and in that case they <strong>must not have</strong> quotes while <code>value.var</code> <strong>must have</strong> quotes.</p>
</section>
<section id="pivot_longer-and-melt" class="level2">
<h2 class="anchored" data-anchor-id="pivot_longer-and-melt"><code>pivot_longer</code> and <code>melt</code></h2>
<p><code>pivot_longer</code> and <code>melt</code> take data and reshape it so that there are more rows and fewer columns than the input data. It allows you to specify specify columns that you want aggregated and the new column names for what was the column names and the values column.</p>
<div id="fig-original-longer" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-original" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r/original.png" class="img-fluid figure-img" data-ref-parent="fig-original-longer"></p>
<p></p><figcaption class="figure-caption">(a) The original data</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-longer" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../assets/post-assets/2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r/longer.png" class="img-fluid figure-img" data-ref-parent="fig-original-longer"></p>
<p></p><figcaption class="figure-caption">(b) The longer data</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Longer data combines columns and decreases width</figcaption><p></p>
</figure>
</div>
<p>In the example above, the <code>estimatedWait</code> and <code>actualWait</code> columns are consolidated into the <code>waitType</code> column where each row specifies if the corresponding <code>waitTime</code> column is an estimated or actual wait time.</p>
<p>Like the previous two, <code>pivot_longer</code> and <code>melt</code> have some differences, although these are smaller. <code>pivot_longer</code> uses three primary arguments, <code>cols</code>, <code>names_to</code>, and <code>values_to</code> which correspond to <code>measure.vars</code>, <code>variable.name</code>, and <code>value.name</code>, respectively, from <code>melt</code>. Again, the <code>data.table</code> version, <code>melt</code> requires quotes around each argument value while <code>pivot_longer</code> only requires quotes around <code>names_to</code> and <code>values_to</code> because <code>cols</code> is acting as a <code>select</code> statement.</p>
</section>
</section>
<section id="checking-for-duplicates" class="level1">
<h1>Checking for Duplicates</h1>
<p>One of the most important things to keep in mind before using <code>pivot_wider</code> or <code>dcast</code> is knowing if you should have duplicate data or not. If you shouldn’t have any duplicates, you’ll want to double check to make sure. To show you how to do this, I’ve added the first five rows of <code>dt</code> to the end of <code>dt</code>. If you were to try and pivot the resulting <code>data.table</code>, you each value cell would become a list rather than a single value and would look something like this:</p>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>time</th>
<th>amulet</th>
<th>key</th>
<th>punishment</th>
<th>mage</th>
<th>fury</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>08:00:00</td>
<td>&lt;dbl [2]&gt;</td>
<td>&lt;dbl [2]&gt;</td>
<td>&lt;dbl [2]&gt;</td>
<td>&lt;dbl [2]&gt;</td>
<td>&lt;dbl [2]&gt;</td>
</tr>
<tr class="even">
<td>08:05:00</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
</tr>
<tr class="odd">
<td>08:10:00</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
</tr>
<tr class="even">
<td>08:15:00</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
</tr>
<tr class="odd">
<td>08:20:00</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
</tr>
<tr class="even">
<td>08:25:00</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
<td>&lt;dbl [1]&gt;</td>
</tr>
</tbody>
</table>
</div>
<p>That’s okay if you’re expecting multiple values, you’ll just need to remember use use <code>values_fn</code> for <code>pivot_wider</code> or <code>fun.aggregate</code> for <code>dcast</code> to make sure they are being handled appropriately. A common use-case would be something similar to pivot tables in Excel where you want to count each item. In that case, your function argument would be <code>count</code>.</p>
<p>The basic format to check for for duplicates is <code>x[duplicated(x)]</code>. However, <code>duplicated()</code> only returns <code>TRUE</code> for the second or more occurrence of an item in <code>x</code>. In order to check for all duplicates, we need to also check <code>fromLast</code> like this: <code>x[duplicated(x) | duplicated(x), fromLast = TRUE]</code>. Once you have identified your duplicate rows, it is up to you what to do. In some cases, you might be okay using <code>unique(x)</code> to get only unique items, or you might want to discard all duplicated items altogether with <code>x[!duplicated(x) &amp; !duplicated(x, fromLast = TRUE)]</code>.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/DuplicatedData_11f193c5ddcf84c8f03a207773bd0460">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create duplicated data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dtDuplicated <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dt, dt[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># DuplicatedData.csv</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dtDuplicated <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="sc">!</span><span class="fu">c</span>(rideName, attendance, estimatedWait), </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_from =</span> shortName, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_from =</span> actualWait)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># DuplicatedOnly.csv</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># show all duplicated rows</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>dtDuplicated <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(dtDuplicated) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">duplicated</span>(dtDuplicated, <span class="at">fromLast =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rideName, time)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># DuplicatedDropped.csv</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># drop duplicated rows</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>dtDuplicated <span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pivot-wider" class="level1">
<h1>Pivot Wider</h1>
<section id="wider-with-one-value-column" class="level2">
<h2 class="anchored" data-anchor-id="wider-with-one-value-column">Wider with One Value Column</h2>
<p>In this example, we want to know how long the <code>actualWait</code> is for each ride throughout the day with each recording time as a row, and each ride as a column.</p>
<p>In the <code>pivot_wider</code>, we want our new column <code>names_from</code> to be the <code>shortName</code> and our <code>values_from</code> <code>actualWait</code>. The tricky bit here is the <code>id_cols</code> argument. <code>id_cols</code> are columns whose values should uniquely identify each row in the data. We need to use it because the <code>rideName</code> and <code>shortName</code> columns are perfectly correlated, that is, for each row the value of both columns will always be the same. Any column that is not in the <code>names_from</code> or <code>values_from</code> argument will be part of the default <code>id_cols</code> argument. We can use the argument two ways; we can use a numeric vector to select the columns that we want to be used as identifiers, or we can specify columns that we do not want used as a character or column name vector. In the example below, I’ve included both methods. For the rest of the post, I’ll be using the second method.</p>
<p>As mentioned previously, the biggest difference for <code>dcast</code> is that it uses a formula instead of the <code>id_cols</code> and <code>names_from</code> arguments. The left hand side of the formula is the columns that you want to stay as columns to be used as the unique identifier for each row. The right hand side of the formula is the column whose values will be used as the new column names. Lastly, <code>value.var</code> defines the column with the desired values.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/PivotWider_e9abd1951f004cda4e2685c02ca21f85">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider with one value column</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> shortName, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> actualWait)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="sc">!</span><span class="fu">c</span>(rideName, attendance, estimatedWait), </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> shortName, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> actualWait)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(time <span class="sc">~</span> shortName, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.var =</span> <span class="st">"actualWait"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<thead>
<tr class="header">
<th>time</th>
<th>amulet</th>
<th>key</th>
<th>punishment</th>
<th>mage</th>
<th>fury</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>08:00:00</td>
<td>54</td>
<td>64</td>
<td>55</td>
<td>33</td>
<td>19</td>
</tr>
<tr class="even">
<td>08:05:00</td>
<td>48</td>
<td>54</td>
<td>40</td>
<td>56</td>
<td>55</td>
</tr>
<tr class="odd">
<td>08:10:00</td>
<td>59</td>
<td>44</td>
<td>50</td>
<td>52</td>
<td>35</td>
</tr>
<tr class="even">
<td>08:15:00</td>
<td>47</td>
<td>71</td>
<td>46</td>
<td>41</td>
<td>59</td>
</tr>
<tr class="odd">
<td>08:20:00</td>
<td>26</td>
<td>68</td>
<td>64</td>
<td>47</td>
<td>48</td>
</tr>
<tr class="even">
<td>08:25:00</td>
<td>35</td>
<td>32</td>
<td>54</td>
<td>54</td>
<td>57</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="wider-with-two-or-more-value-columns" class="level2">
<h2 class="anchored" data-anchor-id="wider-with-two-or-more-value-columns">Wider with Two or More Value Columns</h2>
<p>Wider data with more than one value column is very similar to one value column. The only changes you need to make in <code>pivot_wider</code> are changing your <code>id_cols</code> argument if using the column name method and adding the new column to the <code>values_from</code> argument. The only change needed in <code>dcast</code> is adding to the <code>value.var</code> argument. One important thing to note is that the column names will now be a combination of the <code>names_from</code>/right hand side argument and the <code>values_from</code>/<code>value.var</code> argument. The column name order in the <code>value*</code> argument determines the column order in the resulting data.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/PivotWiderTwoRight_4b31a75791f4974a1c55c542c13d6cbb">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider with two value columns</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="sc">!</span><span class="fu">c</span>(rideName, attendance), </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> shortName, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> <span class="fu">c</span>(estimatedWait, actualWait))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(time <span class="sc">~</span> shortName, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">"estimatedWait"</span>, <span class="st">"actualWait"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>time</th>
<th>estimatedWait_amulet</th>
<th>estimatedWait_key</th>
<th>estimatedWait_punishment</th>
<th>estimatedWait_mage</th>
<th>estimatedWait_fury</th>
<th>actualWait_amulet</th>
<th>actualWait_key</th>
<th>actualWait_punishment</th>
<th>actualWait_mage</th>
<th>actualWait_fury</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>08:00:00</td>
<td>53</td>
<td>62</td>
<td>56</td>
<td>40</td>
<td>30</td>
<td>54</td>
<td>64</td>
<td>55</td>
<td>33</td>
<td>19</td>
</tr>
<tr class="even">
<td>08:05:00</td>
<td>45</td>
<td>50</td>
<td>36</td>
<td>52</td>
<td>52</td>
<td>48</td>
<td>54</td>
<td>40</td>
<td>56</td>
<td>55</td>
</tr>
<tr class="odd">
<td>08:10:00</td>
<td>59</td>
<td>41</td>
<td>47</td>
<td>57</td>
<td>37</td>
<td>59</td>
<td>44</td>
<td>50</td>
<td>52</td>
<td>35</td>
</tr>
<tr class="even">
<td>08:15:00</td>
<td>45</td>
<td>61</td>
<td>47</td>
<td>32</td>
<td>62</td>
<td>47</td>
<td>71</td>
<td>46</td>
<td>41</td>
<td>59</td>
</tr>
<tr class="odd">
<td>08:20:00</td>
<td>33</td>
<td>69</td>
<td>61</td>
<td>50</td>
<td>50</td>
<td>26</td>
<td>68</td>
<td>64</td>
<td>47</td>
<td>48</td>
</tr>
<tr class="even">
<td>08:25:00</td>
<td>31</td>
<td>34</td>
<td>47</td>
<td>55</td>
<td>60</td>
<td>35</td>
<td>32</td>
<td>54</td>
<td>54</td>
<td>57</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="pivot-wider-two-or-more-id-columns" class="level2">
<h2 class="anchored" data-anchor-id="pivot-wider-two-or-more-id-columns">Pivot Wider Two or More ID Columns</h2>
<p>Again, this is pretty similar to a “normal” wider operation. With <code>pivot_wider</code> you expand your <code>id_cols</code> to include the new columns, or, in my case, drop the <code>attendance</code> column so that it is now included. With <code>dcast</code>, you simply add the new column to the left hand side of the formula.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/PivotWiderTwoLeft_04e3f2231483098df2c7fcf6847fb17b">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider with two id columns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="sc">!</span><span class="fu">c</span>(rideName, estimatedWait),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> shortName,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> actualWait)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(time <span class="sc">+</span> attendance <span class="sc">~</span> shortName,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.var =</span> <span class="st">"actualWait"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<thead>
<tr class="header">
<th>time</th>
<th>attendance</th>
<th>amulet</th>
<th>key</th>
<th>punishment</th>
<th>mage</th>
<th>fury</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>08:00:00</td>
<td>5090</td>
<td>54</td>
<td>64</td>
<td>55</td>
<td>33</td>
<td>19</td>
</tr>
<tr class="even">
<td>08:05:00</td>
<td>4883</td>
<td>48</td>
<td>54</td>
<td>40</td>
<td>56</td>
<td>55</td>
</tr>
<tr class="odd">
<td>08:10:00</td>
<td>4910</td>
<td>59</td>
<td>44</td>
<td>50</td>
<td>52</td>
<td>35</td>
</tr>
<tr class="even">
<td>08:15:00</td>
<td>4856</td>
<td>47</td>
<td>71</td>
<td>46</td>
<td>41</td>
<td>59</td>
</tr>
<tr class="odd">
<td>08:20:00</td>
<td>4967</td>
<td>26</td>
<td>68</td>
<td>64</td>
<td>47</td>
<td>48</td>
</tr>
<tr class="even">
<td>08:25:00</td>
<td>4710</td>
<td>35</td>
<td>32</td>
<td>54</td>
<td>54</td>
<td>57</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="pivot-longer" class="level1">
<h1>Pivot Longer</h1>
<p><code>pivot_longer</code> and <code>melt</code> are very similar. The largest differences are the argument names and where they require argument values to be in quotes. <code>cols</code>/<code>measure.vars</code> are the columns that you want to be aggregated into a single new column. This argument must be in quotes for <code>melt</code>, but does not have to be for <code>pivot_longer</code> and should be the names of existing columns. <code>names_to</code>/<code>values_to</code> is the name of the column that will say which column was used for that row and <code>values_to</code>/<code>value.name</code> are the corresponding values. The name for each of these new columns is up to you. I have decided on <code>waitType</code> to describe if it is an <code>estimatedWait</code> or <code>actualWait</code> and <code>waitTime</code> to hold the value.</p>
<p>I’ve saved a copy of the longer data as <code>dtLonger</code> so that we can explore <code>pivot_wider</code> and <code>dcast</code> a bit more.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/PivotLonger_11c27a890b55515a46c92f059a764737">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot longer</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(estimatedWait, actualWait), </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">names_to =</span> <span class="st">"waitType"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values_to =</span> <span class="st">"waitTime"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">"estimatedWait"</span>, <span class="st">"actualWait"</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">variable.name =</span> <span class="st">"waitType"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">value.name =</span> <span class="st">"waitTime"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>() <span class="ot">-&gt;</span> dtLonger</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 31%">
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>rideName</th>
<th>shortName</th>
<th>time</th>
<th>attendance</th>
<th>waitType</th>
<th>waitTime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>The Amulet from Below</td>
<td>amulet</td>
<td>08:00:00</td>
<td>5090</td>
<td>estimatedWait</td>
<td>53</td>
</tr>
<tr class="even">
<td>The Strong Key Mystery</td>
<td>key</td>
<td>08:00:00</td>
<td>5090</td>
<td>estimatedWait</td>
<td>62</td>
</tr>
<tr class="odd">
<td>The Punishment of Bane</td>
<td>punishment</td>
<td>08:00:00</td>
<td>5090</td>
<td>estimatedWait</td>
<td>56</td>
</tr>
<tr class="even">
<td>The Mage Beyond the Grave</td>
<td>mage</td>
<td>08:00:00</td>
<td>5090</td>
<td>estimatedWait</td>
<td>40</td>
</tr>
<tr class="odd">
<td>The Fury from Beyond</td>
<td>fury</td>
<td>08:00:00</td>
<td>5090</td>
<td>estimatedWait</td>
<td>30</td>
</tr>
<tr class="even">
<td>The Amulet from Below</td>
<td>amulet</td>
<td>08:05:00</td>
<td>4883</td>
<td>estimatedWait</td>
<td>45</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="pivot-wider-from-longer" class="level1">
<h1>Pivot Wider (from Longer)</h1>
<section id="pivot-wider-with-two-or-more-name-columns" class="level2">
<h2 class="anchored" data-anchor-id="pivot-wider-with-two-or-more-name-columns">Pivot Wider with Two or More Name Columns</h2>
<p>We want to take our new longer data and change it to wider data where we want to know how long the <code>actualWait</code> and <code>estimatedWait</code> are for each ride throughout the day with each recording time as a row, and each ride as a column and <code>waitType</code> and <code>shortName</code>.</p>
<p>For <code>pivot_wider</code>, we want our column names to use both the <code>waitType</code> and <code>shortName</code> and our values from <code>waitTime</code>. <code>id_cols</code> is then the remaining columns that we don’t want. With <code>dcast</code>, we want to add <code>waitType</code> and <code>shortName</code> to the right hand side of the formula so they are used as the column names, and <code>time</code> to the left hand side for the row identifiers. For both, <code>values_from</code> and <code>value.var</code> are our <code>waitTime</code> column.</p>
<p>Like when using multiple values in <code>value_from</code>/<code>value.var</code>, the new column names are all combinations of values in <code>names_from</code> or right hand side. The combinations will be given in the order the column names are specified.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/PivotWiderFromLonger_7b519ca74494db33655ceda1030a0aec">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider with more than one right hand column</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dtLonger <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="sc">!</span><span class="fu">c</span>(rideName, attendance), </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_from =</span> <span class="fu">c</span>(waitType, shortName), </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_from =</span> waitTime)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>dtLonger <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(time <span class="sc">~</span> waitType <span class="sc">+</span> shortName, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">value.var =</span> <span class="st">"waitTime"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>time</th>
<th>estimatedWait_amulet</th>
<th>estimatedWait_key</th>
<th>estimatedWait_punishment</th>
<th>estimatedWait_mage</th>
<th>estimatedWait_fury</th>
<th>actualWait_amulet</th>
<th>actualWait_key</th>
<th>actualWait_punishment</th>
<th>actualWait_mage</th>
<th>actualWait_fury</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>08:00:00</td>
<td>53</td>
<td>62</td>
<td>56</td>
<td>40</td>
<td>30</td>
<td>54</td>
<td>64</td>
<td>55</td>
<td>33</td>
<td>19</td>
</tr>
<tr class="even">
<td>08:05:00</td>
<td>45</td>
<td>50</td>
<td>36</td>
<td>52</td>
<td>52</td>
<td>48</td>
<td>54</td>
<td>40</td>
<td>56</td>
<td>55</td>
</tr>
<tr class="odd">
<td>08:10:00</td>
<td>59</td>
<td>41</td>
<td>47</td>
<td>57</td>
<td>37</td>
<td>59</td>
<td>44</td>
<td>50</td>
<td>52</td>
<td>35</td>
</tr>
<tr class="even">
<td>08:15:00</td>
<td>45</td>
<td>61</td>
<td>47</td>
<td>32</td>
<td>62</td>
<td>47</td>
<td>71</td>
<td>46</td>
<td>41</td>
<td>59</td>
</tr>
<tr class="odd">
<td>08:20:00</td>
<td>33</td>
<td>69</td>
<td>61</td>
<td>50</td>
<td>50</td>
<td>26</td>
<td>68</td>
<td>64</td>
<td>47</td>
<td>48</td>
</tr>
<tr class="even">
<td>08:25:00</td>
<td>31</td>
<td>34</td>
<td>47</td>
<td>55</td>
<td>60</td>
<td>35</td>
<td>32</td>
<td>54</td>
<td>54</td>
<td>57</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="pivot-wider-with-mutiple-id-and-name-columns" class="level2">
<h2 class="anchored" data-anchor-id="pivot-wider-with-mutiple-id-and-name-columns">Pivot Wider with Mutiple ID and Name Columns</h2>
<p>If you’ve been following along so far, the code below should make sense. We want to use <code>time</code> and <code>attendance</code> as the row identifiers and the <code>estimatedWait</code> and <code>actualWait</code> as the values for each ride.</p>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/PivotWiderTwoLeftRight_75cbd3be773475f890db37ad27c430ae">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider with more than one left and right hand column</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dtLonger <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="sc">!</span>rideName, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_from =</span> <span class="fu">c</span>(waitType, shortName), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_from =</span> waitTime)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>dtLonger <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(time <span class="sc">+</span> attendance <span class="sc">~</span> waitType <span class="sc">+</span> shortName, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">value.var =</span> <span class="st">"waitTime"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>time</th>
<th>attendance</th>
<th>estimatedWait_amulet</th>
<th>estimatedWait_key</th>
<th>estimatedWait_punishment</th>
<th>estimatedWait_mage</th>
<th>estimatedWait_fury</th>
<th>actualWait_amulet</th>
<th>actualWait_key</th>
<th>actualWait_punishment</th>
<th>actualWait_mage</th>
<th>actualWait_fury</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>08:00:00</td>
<td>5090</td>
<td>53</td>
<td>62</td>
<td>56</td>
<td>40</td>
<td>30</td>
<td>54</td>
<td>64</td>
<td>55</td>
<td>33</td>
<td>19</td>
</tr>
<tr class="even">
<td>08:05:00</td>
<td>4883</td>
<td>45</td>
<td>50</td>
<td>36</td>
<td>52</td>
<td>52</td>
<td>48</td>
<td>54</td>
<td>40</td>
<td>56</td>
<td>55</td>
</tr>
<tr class="odd">
<td>08:10:00</td>
<td>4910</td>
<td>59</td>
<td>41</td>
<td>47</td>
<td>57</td>
<td>37</td>
<td>59</td>
<td>44</td>
<td>50</td>
<td>52</td>
<td>35</td>
</tr>
<tr class="even">
<td>08:15:00</td>
<td>4856</td>
<td>45</td>
<td>61</td>
<td>47</td>
<td>32</td>
<td>62</td>
<td>47</td>
<td>71</td>
<td>46</td>
<td>41</td>
<td>59</td>
</tr>
<tr class="odd">
<td>08:20:00</td>
<td>4967</td>
<td>33</td>
<td>69</td>
<td>61</td>
<td>50</td>
<td>50</td>
<td>26</td>
<td>68</td>
<td>64</td>
<td>47</td>
<td>48</td>
</tr>
<tr class="even">
<td>08:25:00</td>
<td>4710</td>
<td>31</td>
<td>34</td>
<td>47</td>
<td>55</td>
<td>60</td>
<td>35</td>
<td>32</td>
<td>54</td>
<td>54</td>
<td>57</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="wrapping-things-up" class="level1">
<h1>Wrapping Things Up</h1>
<section id="a-quick-benchmark" class="level2">
<h2 class="anchored" data-anchor-id="a-quick-benchmark">A quick benchmark</h2>
<div class="cell" data-hash="2022-03-31-pivoting-data-with-tidyverse-and-datatable-in-r_cache/html/Benchmark_2f27f2ed2674a4a871801f614d0886c9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rbenchmark<span class="sc">::</span><span class="fu">benchmark</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pivot_wider"</span> <span class="ot">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="sc">!</span><span class="fu">c</span>(rideName, attendance, estimatedWait), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_from =</span> shortName, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_from =</span> actualWait)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dcast"</span> <span class="ot">=</span> {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(time <span class="sc">~</span> shortName, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value.var =</span> <span class="st">"actualWait"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">order =</span> <span class="st">"user.self"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>rbenchmark<span class="sc">::</span><span class="fu">benchmark</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pivot_longer"</span> <span class="ot">=</span> {</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(estimatedWait, actualWait), </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">names_to =</span> <span class="st">"waitType"</span>, </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">values_to =</span> <span class="st">"waitTime"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"melt"</span> <span class="ot">=</span> {</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">"estimatedWait"</span>, <span class="st">"actualWait"</span>),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variable.name =</span> <span class="st">"waitType"</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value.name =</span> <span class="st">"waitTime"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">order =</span> <span class="st">"user.self"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>test</th>
<th>replications</th>
<th>elapsed</th>
<th>relative</th>
<th>user.self</th>
<th>sys.self</th>
<th>user.child</th>
<th>sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dcast</code></td>
<td>100</td>
<td>0.060</td>
<td>1.00</td>
<td>0.059</td>
<td>0.001</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td><code>pivot_wider</code></td>
<td>100</td>
<td>0.309</td>
<td>5.15</td>
<td>0.307</td>
<td>0.002</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper" data-markdown="block">
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>test</th>
<th>replications</th>
<th>elapsed</th>
<th>relative</th>
<th>user.self</th>
<th>sys.self</th>
<th>user.child</th>
<th>sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>melt</code></td>
<td>100</td>
<td>0.005</td>
<td>1.0</td>
<td>0.005</td>
<td>0.000</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td><code>pivot_longer</code></td>
<td>100</td>
<td>0.152</td>
<td>30.4</td>
<td>0.149</td>
<td>0.003</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p><code>data.table</code> methods are faster than <code>tidyverse</code> and wider to longer is faster than longer to wider.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I’m hoping that by now you’re more comfortable with <code>pivot_wider</code>/<code>dcast</code> and <code>pivot_longer</code>/<code>melt</code> than you were before. Generally, before you begin reshaping data, you want to know what your resulting data should look like and if you’ll have any duplicate rows. From there, decide if you want to use <code>tidyverse</code> or <code>data.table</code> and then write your code.</p>
<hr>
<p>All code used in this article is available <a href="https://gist.github.com/guslipkin/34a3a9e84f9cddd9c54a8e76f1f68b4d">here</a>. If you want to see more from me, check out <a href="https://github.com/guslipkin">my GitHub</a> or <a href="https://guslipkin.github.io">guslipkin.github.io</a>. If you want to hear from me, I’m also on Twitter <a href="https://twitter.com/GusLipkin"><span class="citation" data-cites="guslipkin">@guslipkin</span></a>.</p>
<center>
<em>Gus Lipkin is a Data Scientist, Business Analyst, and occasional bike mechanic</em>
</center>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>